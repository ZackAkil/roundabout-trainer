<!DOCTYPE html>
<html>
<head>
    <title>Roundabout Training</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js"></script>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
    </style>
</head>
<body>
<script>
const config = {
    type: Phaser.AUTO,
    width: 600,
    height: 600,
    backgroundColor: '#FFFFFF', // Add this line to set white background
    physics: {
        default: 'arcade',
        arcade: {
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);
let car;
let cursors;
let centerPoint;
let score = 0;
let scoreText;
let wrongWayText;

let speed = 0;
const maxSpeed = 5;
const acceleration = 0.2;
const deceleration = 0.1;

function preload() {

    this.load.image('car', 'assets/car.png', {
        width: 10,
        height: 20
    });
    console.log("loaded car")

}

function create() {
    // Draw roundabout
    const graphics = this.add.graphics();
    graphics.lineStyle(4, 0x666666);
    graphics.strokeCircle(400, 300, 100);
    graphics.strokeCircle(400, 300, 150);
    
    // Add center point for rotation reference
    centerPoint = new Phaser.Geom.Point(400, 300);
    
    // Create car
    car = this.add.sprite(400, 450, 'car');
    car.setScale(0.1)
    car.angle = -90; // Start facing left
    
    // Add score text
    scoreText = this.add.text(16, 16, 'Score: 0', { fontSize: '32px', fill: '#000' });
    wrongWayText = this.add.text(400, 50, '', { fontSize: '32px', fill: '#ff0000' });
    wrongWayText.setOrigin(0.5);
    
    // Setup keyboard controls
    cursors = this.input.keyboard.createCursorKeys();
}

function update() {
    if (!car) return;
    
    const angleToCenter = Phaser.Math.Angle.Between(car.x, car.y, centerPoint.x, centerPoint.y);
    const distanceToCenter = Phaser.Math.Distance.Between(car.x, car.y, centerPoint.x, centerPoint.y);
    
    // Handle acceleration
    if (cursors.up.isDown) {
        speed = Math.min(maxSpeed, speed + acceleration);
    } else {
        // Decelerate when not accelerating
        speed = Math.max(0, speed - deceleration);
    }
    
    // Apply movement with current speed
    if (speed > 0) {
        const rad = Phaser.Math.DegToRad(car.angle - 90);
        car.x += Math.cos(rad) * speed;
        car.y += Math.sin(rad) * speed;
        
        // Check if in roundabout bounds
        if (distanceToCenter > 100 && distanceToCenter < 150) {
            const carDirection = Phaser.Math.Angle.Wrap(Phaser.Math.DegToRad(car.angle - 90));
            const tangentAngle = angleToCenter + Math.PI/2;
            const angleDiff = Phaser.Math.Angle.Wrap(carDirection - tangentAngle);
            
            if (Math.abs(angleDiff) < Math.PI/2) {
                score += 1;
                scoreText.setText('Score: ' + score);
                wrongWayText.setText('');
            } else {
                wrongWayText.setText('Wrong Way!');
            }
        }
    }
    
    // Handle turning
    if (cursors.left.isDown) {
        // Make turning speed relative to current speed
        car.angle -= 3 * (speed / maxSpeed);
    }
    if (cursors.right.isDown) {
        car.angle += 3 * (speed / maxSpeed);
    }
}
</script>
</body>
</html>