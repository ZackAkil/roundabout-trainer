<!DOCTYPE html>
<html>
  <head>
    <title>Roundabout Training</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.70.0/phaser.min.js"></script>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <script>
      const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        backgroundColor: "#FFFFFF", // Add this line to set white background
        physics: {
          default: "arcade",
          arcade: {
            debug: false,
          },
        },
        scene: {
          preload: preload,
          create: create,
          update: update,
        },
      };

      const game = new Phaser.Game(config);
      let car;
      let cursors;
      let score = 0;
      let scoreText;

      function preload() {
        this.load.image("car", "assets/car.png", {
          width: 10,
          height: 20,
        });
      }

      function create() {
        // Create roundabout object
        const roundabout = new Roundabout(
          this,
          (x = 400),
          (y = 300),
          (innerRadius = 100),
          (innerRadius = 150)
        );

        car = new Car(this, 400, 550, "car");

        scoreText = this.add.text(16, 16, "Score: 0", {
          fontSize: "32px",
          fill: "#000",
        });

        // Setup keyboard controls
        cursors = this.input.keyboard.createCursorKeys();
      }

      function update() {
        if (!car) return;
        car.update(cursors);
      }

      class Car {
        maxSpeed = 5;
        acceleration = 0.1;
        deceleration = 0.01;
        brakingPower = 0.1;
        turningSpeed = 0.2;
        maxTurningAngle = 5;
        minTurningAngle = -5;

        constructor(scene, x, y, texture) {
          this.sprite = scene.add.sprite(x, y, texture);
          this.sprite.setScale(0.1);
          this.sprite.angle = 0; // Start facing north
          this.speed = 0;
          this.currentTurningAngle = 0;
        }

        update(cursors) {
          // Handle acceleration
          if (cursors.up.isDown) {
            this.speed = Math.min(
              this.maxSpeed,
              this.speed + this.acceleration
            );
          } else {
            this.speed = Math.max(0, this.speed - this.deceleration);
          }
          // Handle braking
          if (cursors.down.isDown) {
            this.speed = Math.max(0, this.speed - this.brakingPower);
          }

          // Apply movement with current speed
          if (this.speed > 0) {
            const rad = Phaser.Math.DegToRad(this.sprite.angle - 90);
            this.sprite.x += Math.cos(rad) * this.speed;
            this.sprite.y += Math.sin(rad) * this.speed;
          }

          // Handle turning
          if (cursors.left.isDown) {
            this.currentTurningAngle = Math.max(
              this.minTurningAngle,
              this.currentTurningAngle - this.turningSpeed
            );
          }
          if (cursors.right.isDown) {
            this.currentTurningAngle = Math.min(
              this.maxTurningAngle,
              this.currentTurningAngle + this.turningSpeed
            );
          }
          this.sprite.angle +=
            this.currentTurningAngle * (this.speed / this.maxSpeed);
        }
      }

      class Roundabout {
        constructor(scene, x, y, innerRadius, outerRadius) {
          this.scene = scene;
          this.x = x;
          this.y = y;
          this.innerRadius = innerRadius;
          this.outerRadius = outerRadius;
          this.graphics = scene.add.graphics();
          this.drawRoundabout();
        }

        drawRoundabout() {
          // Draw inner circle
          this.graphics.lineStyle(4, 0x666666);
          this.graphics.strokeCircle(this.x, this.y, this.innerRadius);

          // Draw outer circle
          this.graphics.lineStyle(4, 0x666666);
          this.graphics.strokeCircle(this.x, this.y, this.outerRadius);

          // Draw exits
          this.graphics.lineStyle(4, 0x666666);
          this.graphics.moveTo(this.x, this.y - this.outerRadius);
          this.graphics.lineTo(this.x, this.y - this.outerRadius - 50);
          this.graphics.strokePath();

          this.graphics.moveTo(this.x + this.outerRadius, this.y);
          this.graphics.lineTo(this.x + this.outerRadius + 50, this.y);
          this.graphics.strokePath();

          this.graphics.moveTo(this.x, this.y + this.outerRadius);
          this.graphics.lineTo(this.x, this.y + this.outerRadius + 50);
          this.graphics.strokePath();

          this.graphics.moveTo(this.x - this.outerRadius, this.y);
          this.graphics.lineTo(this.x - this.outerRadius - 50, this.y);
          this.graphics.strokePath();
        }
      }
    </script>
  </body>
</html>
